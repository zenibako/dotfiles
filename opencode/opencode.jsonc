/**
 * # PREREQUISITES:
 * - OpenCode CLI: https://opencode.ai/docs/cli/installation
 * - `npm install`
 * - Review this file and follow any inline directions in the comments.
 *
 * # INSTRUCTIONS:
 * 1. Copy this file to `~/.config/opencode/`. Remove any other `opencode.json` or `opencode.jsonc` files in that directory.
 * 2. Authenticate with Github Copilot: https://opencode.ai/docs/cli/authentication
 * 3. Run OpenCode and select the model you want to use from Github Copilot: `opencode` `/models`
 * 4. Go forth and prompt!
 */
{
  "$schema": "https://opencode.ai/config.json",
  "mcp": {
    "Jujutsu": {
      "type": "local",
      "command": [
        "npx",
        "-y",
        "jj-mcp-server"
      ],
      "enabled": true
    },
    "GitHub": {
      "type": "local",
      "command": [
        "npx",
        "-y",
        "@modelcontextprotocol/server-github"
      ],
      "environment": {
        "GITHUB_PERSONAL_ACCESS_TOKEN": "{{github_personal_access_token}}"
      },
      "enabled": true
    },
{{#if opencode_profile_work}}
    "GitLab": {
      "type": "local",
      "command": [
        "npx",
        "-y",
        "@modelcontextprotocol/server-gitlab"
      ],
      "environment": {
        "GITLAB_PERSONAL_ACCESS_TOKEN": "{{gitlab_personal_access_token}}",
        "GITLAB_API_URL": "{{gitlab_api_url}}"
      },
      "enabled": true
    },
{{#if mcp_salesforce_dx}}
    "Salesforce DX": {
      "type": "local",
      "command": [
        "npx",
        "-y",
        "@salesforce/mcp",
        "--orgs",
        "DEFAULT_TARGET_ORG",
        "--toolsets",
        "all",
        "--allow-non-ga-tools"
      ],
      "enabled": true
    },
{{/if}}
{{#if mcp_odaseva}}
    "Odaseva": {
      "type": "local",
      "command": [
        "oda-mcp"
      ],
      "enabled": true
    },
{{/if}}
{{#if mcp_atlassian}}
    "Atlassian": {
      "type": "local",
      "command": [
        "npx",
        "-y",
        "mcp-remote",
        "https://mcp.atlassian.com/v1/sse"
      ],
      "enabled": true
    },
{{/if}}
{{#if mcp_postman}}
    "Postman": {
      "type": "remote",
      "url": "https://mcp.postman.com/mcp",
      "headers": {
        "Authorization": "Bearer {{postman_api_key}}"
      },
      "enabled": true
    },
{{/if}}
{{#if mcp_sonarqube}}
    "SonarQube": {
      "type": "local",
      "command": [
        "docker",
        "run",
        "-i",
        "--name",
        "sonarqube-mcp-server",
        "--rm",
        "-e",
        "SONARQUBE_TOKEN",
        "-e",
        "SONARQUBE_URL",
        "mcp/sonarqube"
      ],
      "environment": {
        "SONARQUBE_URL": "{{sonarqube_url}}",
        "SONARQUBE_TOKEN": "{{sonarqube_token}}"
      },
      "enabled": true
    },
{{/if}}
    "Backlog": {
      "type": "local",
      "command": [
        "backlog",
        "mcp",
        "start"
      ],
      "enabled": true
    },
    "Neovim": {
      "type": "local",
      "command": [
        "npx",
        "-y",
        "mcp-neovim-server"
      ],
      "environment": {
        "ALLOW_SHELL_COMMANDS": "true",
        "NVIM_SOCKET_PATH": "/tmp/nvim"
      },
      "enabled": false
    },
    "Chrome DevTools": {
      "type": "local",
      "command": [
        "zsh",
        "-c",
        "source ~/.nvm/nvm.sh && nvm use --lts >&2 && npx chrome-devtools-mcp@latest"
      ],
      "enabled": true
    }
{{/if}}
  },
  "lsp": {
{{#if opencode_profile_work}}
    "apex-language-server": {
      "command": [
        "java",
        "-cp",
        "{{apex_lsp_jar_path}}",
        "-Ddebug.internal.errors=true",
        "-Ddebug.semantic.errors=true",
        "-Ddebug.completion.statistics=false",
        "-Dlwc.typegeneration.disabled=true",
        "apex.jorje.lsp.ApexLanguageServerLauncher"
      ],
      "extensions": [
        ".apex",
        ".cls",
        ".trigger"
      ],
      "disabled": false,
      "initialization": {
        "enableSemanticErrors": true,
        "enableCompletionStatistics": false
      }
    },
    "lwc-language-server": {
      "command": [
        "~/.config/opencode/script/lwc-lsp-wrapper.sh"
      ],
      "extensions": [
        ".js",
        ".html"
      ],
      "disabled": false
    },
    "visualforce-language-server": {
      "command": [
        "$HOME/.local/share/nvim/mason/bin/visualforce-language-server",
        "--stdio"
      ],
      "extensions": [
        ".page",
        ".component"
      ],
      "disabled": false
    },
{{/if}}
    "sourcekit-lsp": {
      "command": [
        "sourcekit-lsp"
      ],
      "extensions": [
        ".swift"
      ]
    },
    "cue": {
      "command": [
        "cue",
        "lsp"
      ],
      "extensions": [
        ".cue"
      ]
    },
    "typescript-language-server": {
      "command": [
        "typescript-language-server",
        "--stdio"
      ],
      "extensions": [
        ".ts",
        ".tsx",
        ".js",
        ".jsx"
      ]
    }
  },
  "provider": {
    "ollama": {
      "npm": "@ai-sdk/openai-compatible",
      "name": "Ollama",
      "options": {
        "baseURL": "http://10.0.7.73:11434/v1"
      },
      "models": {
        "qwen3-coder:latest": {
          "name": "Qwen3 Coder"
        }
      }
    }
  },
  "agent": {
    "build": {
      "model": "{{#if opencode_build_agent_model}}{{opencode_build_agent_model}}{{else}}anthropic/claude-sonnet-4-5{{/if}}"
    },
    "plan": {
      "model": "{{#if opencode_plan_agent_model}}{{opencode_plan_agent_model}}{{else}}anthropic/claude-opus-4-5{{/if}}"
    },
    "admin": {
      "description": "Handles project administration: Git/Jujutsu history, pushing to remotes, and editing configuration files",
      "mode": "primary",
      "model": "{{#if opencode_admin_agent_model}}{{opencode_admin_agent_model}}{{else}}anthropic/claude-haiku-4-20250514{{/if}}",
      "prompt": "{file:./prompt/admin.txt}",
      "permission": {
        "bash": {
          "git push*": "ask",
          "git push --force*": "ask",
          "git reset --hard*": "ask",
          "git clean*": "ask",
          "git rebase*": "ask",
          "git merge*": "ask",
          "git checkout -f*": "ask",
          "git branch -D*": "ask",
          "jj git push*": "ask",
          "jj abandon*": "ask",
          "jj rebase*": "ask",
          "jj squash*": "ask",
          "rm -rf*": "deny",
          "rm -r*": "ask",
          "*": "allow"
        },
        "edit": "allow"
      }
    }
  }
}
